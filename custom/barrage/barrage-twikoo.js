let ls=[],Num=0,barrageTimer=null;function openBarrage(e){if(null==barrageTimer)if(e=e||"https://twikoo.geekswg.top/",document.body.clientWidth>100){document.getElementById("loading").innerHTML='<div  data-fancybox="gallery" data-caption="弹幕加载中..." data-thumb="/img/loading.svg"><img src="/imgs/gif/yinyang.gif" data-lazy-src="/img/loading.svg" alt="弹幕加载中..." data-ll-status="loaded" class="entered loaded"></div><div class="img-alt is-center">弹幕加载中...</div>';twikoo.getRecentComments({envId:"https://twikoo.geekswg.top/",pageSize:64,includeReply:!0}).then((e=>{e.forEach((e=>{null==e.avatar&&(e.avatar="https://cravatar.cn/avatar/d615d5793929e8c7d70eab5f00f7f5f1?d=mp"),ls.push({img:e.avatar,info:e.nick+"："+formatDanmaku(e.comment),href:e.url+"#"+e.id,close:!0,speed:16,color:"#fff",old_ie_color:"#000000"})})),setTimeout((()=>{document.getElementById("loading").innerHTML=""}),2e3),barrageTimer=setInterval((()=>{Num>=ls.length&&(Num=0),$("body").barrager(ls[Num]),Num++}),1e3)})).catch((function(e){console.error(e)}))}else document.getElementById("loading").innerHTML='<div class="note danger flat"><p>已关闭弹幕功能，请在电脑上查看。</p></div>';else alert("弹幕已开启")}function closeBarrage(){null!=barrageTimer&&($.fn.barrager.removeAll(),clearInterval(barrageTimer),barrageTimer=null)}function formatDanmaku(e){return e=(e=(e=(e=(e=e.replace(/<\/*br>|[\s\uFEFF\xA0]+/g,"")).replace(/<img.*?>/g,"[图片]")).replace(/<a.*?>.*?<\/a>/g,"[链接]")).replace(/<pre.*?>.*?<\/pre>/g,"[代码块]")).replace(/<.*?>/g,"")}